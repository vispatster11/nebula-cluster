imagePullSecrets: []

# FastAPI Configuration
fastapi:
  image:
    repository: "wiki-service"
    tag: "0.1.0"  # Do NOT use `latest`; pin to a version or digest
    pullPolicy: Never  # k3d loads images from host, not pulling
  imagePullSecrets: []
  port: 8000
  replicas: 1
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  securityContext:
    runAsNonRoot: true
    readOnlyRootFilesystem: true
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

# PostgreSQL Configuration
postgresql:
  enabled: true
  image:
    repository: "postgres"
    tag: "15-alpine"
    pullPolicy: IfNotPresent
  auth:
    username: postgres
    password: ""  # Auto-generate if empty
    database: wiki
  primary:
    persistence:
      size: 2Gi
      # Storage class name for k3d/local-path. Change if your cluster uses another class.
      storageClass: "local-path"
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  securityContext:
    # PostgreSQL container runs as 'postgres' user (uid 70 in alpine)
    # fsGroup allows access to PVC volume mounted at /var/lib/postgresql/data
    runAsNonRoot: true
    runAsUser: 70
    runAsGroup: 70
    fsGroup: 70
    allowPrivilegeEscalation: false
  selectorLabels:
    app: postgres

# Prometheus Configuration
prometheus:
  enabled: true
  image:
    repository: "prom/prometheus"
    tag: "v2.48.0"
    pullPolicy: IfNotPresent
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  retention: 15d
  storageSize: 2Gi
  # Storage class used for Prometheus PVC in k3d
  storageClass: "local-path"
  securityContext:
    runAsNonRoot: true
    allowPrivilegeEscalation: false
  selectorLabels:
    app: prometheus

# Grafana Configuration
grafana:
  enabled: true
  image:
    repository: "grafana/grafana"
    tag: "9.0.0"
    pullPolicy: IfNotPresent
  # Grafana admin password: leave empty to auto-generate via Helm helper.
  # If you need a deterministic password for grading, set this value via
  # --set grafana.adminPassword="my-password" when installing.
  adminPassword: "admin"
  adminUser: admin
  replicas: 1
  runAsUser: 472
  fsGroup: 472
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  persistence:
    size: 1Gi
    # Storage class used for Grafana PVC in k3d
    storageClass: "local-path"
  selectorLabels:
    app: grafana

# Ingress Configuration
# Uses Traefik (k3d default) instead of NGINX
ingress:
  enabled: true
  className: "traefik"  # k3d uses Traefik, not NGINX
  hosts:
    - host: "localhost"
      paths:
        - path: /users
          pathType: Prefix
          service: fastapi
          port: 8000
        - path: /posts
          pathType: Prefix
          service: fastapi
          port: 8000
        - path: /metrics
          pathType: Exact
          service: fastapi
          port: 8000
        - path: /grafana
          pathType: Prefix
          service: grafana
          port: 3000

# NetworkPolicy settings
networkPolicy:
  # Labels for selecting the Ingress Controller pods and their namespace.
  # This allows the NetworkPolicy to be portable across different clusters (k3d, GKE, AKS, etc.)
  ingressController:
    # Labels of the namespace where the ingress controller is running
    namespaceLabels:
      kubernetes.io/metadata.name: kube-system
    # Labels of the ingress controller pods
    podLabels:
      app.kubernetes.io/name: traefik

# Test Job Configuration
test:
  selectorLabels:
    app.kubernetes.io/component: test
  # Timeouts for curl commands within the test job
  curl:
    connectTimeout: 5  # seconds to wait for connection
    maxTime: 10        # seconds for the entire operation
